#!/usr/bin/env bqn
âŸ¨ParseHeader
GetFiles
FFISetup
ToFFI
MakeReplacementâŸ© â† â€¢Import "parseAPL.bqn"

map â† [
  "RL_ZERO"â€¿"RLGL_VERSION"
  "RLZERO" â€¿"RLGLVersionString"
]

broken_rlVertexBuffer â† 1â†“"
typedef struct rlVertexBuffer {
    int elementCount;           // Number of elements in the buffer (QUADS)

    float *vertices;            // Vertex position (XYZ - 3 components per vertex) (shader-location = 0)
    float *texcoords;           // Vertex texture coordinates (UV - 2 components per vertex) (shader-location = 1)
    float *normals;             // Vertex normal (XYZ - 3 components per vertex) (shader-location = 2)
    unsigned char *colors;      // Vertex colors (RGBA - 4 components per vertex) (shader-location = 3)
#if defined(GRAPHICS_API_OPENGL_11) || defined(GRAPHICS_API_OPENGL_33)
    unsigned int *indices;      // Vertex indices (in case vertex data comes indexed) (6 indices per quad)
#endif
#if defined(GRAPHICS_API_OPENGL_ES2)
    unsigned short *indices;    // Vertex indices (in case vertex data comes indexed) (6 indices per quad)
#endif
    unsigned int vaoId;         // OpenGL Vertex Array Object id
    unsigned int vboId[5];      // OpenGL Vertex Buffer Objects id (5 types of vertex data)
} rlVertexBuffer;"

fix1_rlVertexBuffer â† 1â†“"
typedef struct rlVertexBuffer {
    int elementCount;           // Number of elements in the buffer (QUADS)

    float *vertices;            // Vertex position (XYZ - 3 components per vertex) (shader-location = 0)
    float *texcoords;           // Vertex texture coordinates (UV - 2 components per vertex) (shader-location = 1)
    unsigned char *colors;      // Vertex colors (RGBA - 4 components per vertex) (shader-location = 3)
    unsigned int *indices;      // Vertex indices (in case vertex data comes indexed) (6 indices per quad)
    unsigned int vaoId;         // OpenGL Vertex Array Object id
    unsigned int vboId[4];      // OpenGL Vertex Buffer Objects id (4 types of vertex data)
} rlVertexBuffer;"

fix2_rlVertexBuffer â† 1â†“"
typedef struct rlVertexBuffer {
    int elementCount;           // Number of elements in the buffer (QUADS)

    float *vertices;            // Vertex position (XYZ - 3 components per vertex) (shader-location = 0)
    float *texcoords;           // Vertex texture coordinates (UV - 2 components per vertex) (shader-location = 1)
    unsigned char *colors;      // Vertex colors (RGBA - 4 components per vertex) (shader-location = 3)
    unsigned short *indices;    // Vertex indices (in case vertex data comes indexed) (6 indices per quad)
    unsigned int vaoId;         // OpenGL Vertex Array Object id
    unsigned int vboId[4];      // OpenGL Vertex Buffer Objects id (4 types of vertex data)
} rlVertexBuffer;"

Fix_rlVertexBuffer â† {
  if â† âŠ‘/broken_rlVertexBufferâ·ğ•©
  il â† if+â‰ broken_rlVertexBuffer
  (ifâŠ¸â†‘âˆ¾fix1_rlVertexBufferâˆ¾ilâŠ¸â†“)ğ•©
}

broken_StatePointerâ†1â†“"
#if defined(GRAPHICS_API_OPENGL_11)
RLAPI void rlEnableStatePointer(int vertexAttribType, void *buffer); // Enable attribute state pointer
RLAPI void rlDisableStatePointer(int vertexAttribType); // Disable attribute state pointer
#endif
"

Fix_StatePointer â† {
  if â† âŠ‘/broken_StatePointerâ·ğ•©
  il â† if+â‰ broken_StatePointer
  (ifâŠ¸â†‘âˆ¾ilâŠ¸â†“)ğ•©
}

libName â† "rlgl"
libPrefix â† "RLAPI"

âŸ¨ header â‹„ autoErrorJson â‹„ replacementFilename
  replacement â‹„ linkOutput
âŸ© â† GetFiles libName

header {ğ•©/ËœÂ¬âˆ¨`ğ•©â‰ âŠ¸â†‘ğ•¨â·ğ•©}Ëœâ†© "/***********************************************************************************
*
*   RLGL IMPLEMENTATION
*
************************************************************************************/
"
header Fix_rlVertexBufferâ†©
header Fix_StatePointerâ†©

Â·â€¿Â·â€¿Â·â€¿Â·â€¿Â·â€¿functions â† headerTree â† libPrefix ParseHeader header
replacement â€¢FLines libNameâ€¿autoErrorJson MakeReplacement â‰(â‹âŠË˜)âŠ¸âŠ(â†•0â€¿5)âˆ¾Â´functions

linkOutput â€¢FChars libNameâ€¿replacementFilename FFISetup ToFFI headerTree
â€¢Out linkOutputâˆ¾" successfully generated"
